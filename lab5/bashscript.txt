#!/bin/bash

# Флаг проверки успешности
is_valid=true

# Поиск всех .txt файлов, добавленных для коммита
staged_files=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.txt$')

# Если .txt файлы найдены
if [[ -n "$staged_files" ]]; then
  echo "Checking .txt files for required content..."
  for file in $staged_files; do
    # Проверяем, что файл существует
    if [[ -f "$file" ]]; then
      # Проверяем, есть ли в файле определенная строка (например, "Author: ")
      if ! grep -q "Author:" "$file"; then
        echo "Error: File '$file' does not contain required text 'Author:'."
        is_valid=false
      fi
    else
      echo "Error: File '$file' not found."
      is_valid=false
    fi
  done
else
  echo "No .txt files staged for commit."
fi

# Если проверка не прошла, отменяем коммит
if [[ "$is_valid" == false ]]; then
  echo "Commit aborted due to file format issues."
  exit 1
fi

echo "All .txt files passed the check."
exit 0
